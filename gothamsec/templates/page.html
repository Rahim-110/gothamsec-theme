{% extends "base.html" %}

{% block title %}{{ get_config("ctf_name") }}{% endblock %}

{% block content %}
<!-- If there's custom page content, show it -->
{% if content %}
<div class="container" style="padding: 3rem 0;">
    {{ content | safe }}
</div>
{% else %}
<!-- Default Home Page Content -->

<!-- Hero Section -->
<div class="hero" style="min-height: 90vh;">
    <div class="hero-content">
        <!-- Animated Logo -->
        <svg class="animate-float" viewBox="0 0 100 100" width="140" height="140"
            style="margin-bottom: 2rem; filter: drop-shadow(0 0 30px rgba(0, 217, 255, 0.5));">
            <defs>
                <linearGradient id="heroLogoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#00d9ff" />
                    <stop offset="100%" style="stop-color:#b026ff" />
                </linearGradient>
            </defs>
            <path d="M50 5 L90 25 L90 55 Q90 75 50 95 Q10 75 10 55 L10 25 Z" fill="none" stroke="url(#heroLogoGradient)"
                stroke-width="3" />
            <path d="M50 30 L35 45 L20 40 L30 55 L25 70 L50 60 L75 70 L70 55 L80 40 L65 45 Z"
                fill="url(#heroLogoGradient)" />
        </svg>

        <h1 class="hero-title">{{ get_config("ctf_name") }}</h1>
        <p class="hero-subtitle">
            {{ get_config("ctf_description") or "Test your cybersecurity skills in our Capture The Flag competition.
            Solve challenges, capture flags, and climb the leaderboard!" }}
        </p>

        <div class="d-flex gap-2 justify-center flex-wrap">
            {% if get_config('registration_visibility') != False %}
            <a href="{{ url_for('auth.register') }}" class="btn btn-primary btn-lg">
                ğŸš€ Register Now
            </a>
            {% endif %}
            <a href="{{ url_for('auth.login') }}" class="btn btn-secondary btn-lg">
                ğŸ” Login
            </a>
            <a href="{{ url_for('challenges.listing') }}" class="btn btn-secondary btn-lg">
                ğŸ¯ Challenges
            </a>
        </div>
    </div>
</div>

<!-- What is CTF Section -->
<section class="section" style="background: linear-gradient(180deg, transparent, rgba(0, 217, 255, 0.05));">
    <div class="container">
        <h2 class="section-title">ğŸ´ What is CTF?</h2>

        <div class="glass-panel" style="max-width: 900px; margin: 0 auto;">
            <p style="font-size: 1.2rem; line-height: 1.8; text-align: center;">
                <strong style="color: var(--gth-cyan);">Capture The Flag (CTF)</strong> is a cybersecurity competition
                where participants solve security-related challenges to find hidden "flags" - secret strings that prove
                you've solved the challenge.
            </p>
            <p
                style="font-size: 1.1rem; line-height: 1.8; text-align: center; margin-top: 1rem; color: var(--gth-text-muted);">
                CTFs are the best way to learn and practice real-world hacking skills in a safe, legal environment.
                Whether you're a beginner or a seasoned security professional, there's always something new to learn!
            </p>
        </div>
    </div>
</section>

<!-- How It Works Section -->
<section class="section">
    <div class="container">
        <h2 class="section-title">ğŸ”§ How It Works</h2>

        <div class="grid grid-4">
            <div class="card text-center">
                <div class="icon-box" style="margin: 0 auto 1rem;">1ï¸âƒ£</div>
                <h4>Register</h4>
                <p class="text-muted">Create your account or join a team to start competing</p>
            </div>

            <div class="card text-center">
                <div class="icon-box" style="margin: 0 auto 1rem;">2ï¸âƒ£</div>
                <h4>Choose a Challenge</h4>
                <p class="text-muted">Browse challenges by category and difficulty level</p>
            </div>

            <div class="card text-center">
                <div class="icon-box" style="margin: 0 auto 1rem;">3ï¸âƒ£</div>
                <h4>Solve & Find Flag</h4>
                <p class="text-muted">Use your skills to solve the challenge and find the flag</p>
            </div>

            <div class="card text-center">
                <div class="icon-box" style="margin: 0 auto 1rem;">4ï¸âƒ£</div>
                <h4>Submit & Score</h4>
                <p class="text-muted">Submit the flag to earn points and climb the leaderboard</p>
            </div>
        </div>
    </div>
</section>

<!-- Challenge Categories Section -->
<section class="section" style="background: linear-gradient(180deg, rgba(176, 38, 255, 0.05), transparent);">
    <div class="container">
        <h2 class="section-title">ğŸ¯ Challenge Categories</h2>

        <div class="grid grid-3">
            <div class="glass-panel">
                <h4 style="color: var(--gth-cyan);">ğŸŒ Web Exploitation</h4>
                <p class="text-muted">Find vulnerabilities in web applications - SQL injection, XSS, CSRF, and more.</p>
            </div>

            <div class="glass-panel">
                <h4 style="color: var(--gth-purple);">ğŸ”“ Cryptography</h4>
                <p class="text-muted">Break encryption, decode messages, and find weaknesses in cryptographic systems.
                </p>
            </div>

            <div class="glass-panel">
                <h4 style="color: var(--gth-cyan);">ğŸ” Reverse Engineering</h4>
                <p class="text-muted">Analyze binaries, understand malware, and crack software protections.</p>
            </div>

            <div class="glass-panel">
                <h4 style="color: var(--gth-purple);">ğŸ’¥ Binary Exploitation</h4>
                <p class="text-muted">Exploit buffer overflows, format strings, and memory corruption bugs.</p>
            </div>

            <div class="glass-panel">
                <h4 style="color: var(--gth-cyan);">ğŸ” Forensics</h4>
                <p class="text-muted">Investigate digital evidence, analyze memory dumps, and recover hidden data.</p>
            </div>

            <div class="glass-panel">
                <h4 style="color: var(--gth-purple);">ğŸ§© Miscellaneous</h4>
                <p class="text-muted">OSINT, steganography, programming challenges, and creative puzzles.</p>
            </div>
        </div>
    </div>
</section>

<!-- Stats Section -->
<section class="section">
    <div class="container">
        <h2 class="section-title">ğŸ“Š Live Stats</h2>

        <div class="d-flex gap-3 justify-center flex-wrap">
            <div class="glass-panel text-center" style="min-width: 180px;">
                <div class="text-cyan" style="font-size: 3rem; font-weight: 700; font-family: var(--gth-font-display);"
                    id="stat-challenges">--</div>
                <div class="text-muted">Challenges</div>
            </div>
            <div class="glass-panel text-center" style="min-width: 180px;">
                <div class="text-purple"
                    style="font-size: 3rem; font-weight: 700; font-family: var(--gth-font-display);" id="stat-players">
                    --</div>
                <div class="text-muted">{{ 'Teams' if get_config('user_mode') == 'teams' else 'Players' }}</div>
            </div>
            <div class="glass-panel text-center" style="min-width: 180px;">
                <div class="text-cyan" style="font-size: 3rem; font-weight: 700; font-family: var(--gth-font-display);"
                    id="stat-solves">--</div>
                <div class="text-muted">Solves</div>
            </div>
        </div>
    </div>
</section>

<!-- Ready to Start Section -->
<section class="section" style="text-align: center; padding-bottom: 6rem;">
    <div class="container">
        <h2>Ready to Test Your Skills?</h2>
        <p class="text-muted mb-4" style="font-size: 1.2rem;">Join hackers competing in our CTF competition</p>

        {% if get_config('registration_visibility') != False %}
        <a href="{{ url_for('auth.register') }}" class="btn btn-primary btn-lg">
            ğŸš€ Get Started Now
        </a>
        {% else %}
        <a href="{{ url_for('auth.login') }}" class="btn btn-primary btn-lg">
            ğŸ” Login to Compete
        </a>
        {% endif %}
    </div>
</section>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
    // Fetch and display stats
    (async function () {
        try {
            const chalResp = await fetch('/api/v1/challenges');
            const chalData = await chalResp.json();
            if (chalData.success) {
                document.getElementById('stat-challenges').textContent = chalData.data.length;
            }
        } catch (e) {
            document.getElementById('stat-challenges').textContent = '0';
        }

        try {
            const mode = '{{ get_config("user_mode") }}';
            const endpoint = mode === 'teams' ? '/api/v1/teams' : '/api/v1/users';
            const playersResp = await fetch(endpoint);
            const playersData = await playersResp.json();
            if (playersData.success) {
                document.getElementById('stat-players').textContent = playersData.data.length;
            }
        } catch (e) {
            document.getElementById('stat-players').textContent = '0';
        }

        try {
            const scoreResp = await fetch('/api/v1/scoreboard');
            const scoreData = await scoreResp.json();
            if (scoreData.success && scoreData.data) {
                const totalSolves = scoreData.data.reduce((acc, team) => {
                    return acc + (team.solves ? team.solves.length : 0);
                }, 0);
                document.getElementById('stat-solves').textContent = totalSolves || '0';
            }
        } catch (e) {
            document.getElementById('stat-solves').textContent = '0';
        }
    })();
</script>
{% endblock %}